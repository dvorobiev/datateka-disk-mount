# Утилита Datateka Disk Mount

Комплексная утилита для управления дисками в стеллаже хранения через последовательное соединение. Этот инструмент позволяет включать/выключать отдельные диски, монтировать/размонтировать их и отслеживать их состояние.

## Особенности

- Включение/выключение отдельных дисков с помощью последовательных команд
- Монтирование/размонтирование дисков с файловой системой XFS
- Отслеживание состояния дисков и доступного пространства
- Визуальное отображение сетки всех дисков в стеллаже хранения
- Поддержка нескольких модулей дисков и позиций
- Ведение журнала всех операций

## Компоненты

### Python скрипты

- `disk_state.py` - Основная утилита управления дисками с интерактивным интерфейсом
- `power_on.py` - Простой скрипт для включения определенного диска

### Shell скрипты

- `scripts/mount_disk.sh` - Скрипт для монтирования дисков XFS с оптимизированными параметрами
- `scripts/power_off.sh` - Скрипт для выключения диска через последовательный порт
- `scripts/power_on.sh` - Скрипт для включения диска через последовательный порт

### Конфигурация

- `DISK_WWN.csv` - CSV-файл, сопоставляющий идентификаторы WWN с позициями дисков и точками монтирования

## Использование

### Основной менеджер дисков

```bash
sudo python3 disk_state.py
```

Основной интерфейс предоставляет визуальную сетку, показывающую состояние всех дисков:
- ○ - Диск выключен
- ●/■ - Диск включен (● для дисков 20ТБ+, ■ для дисков 18ТБ+)
- Оранжевый ● - Диск почти заполнен (>95%)

Управление:
1. Включить диск
2. Выключить диск
3. Обновить отображение
q. Выйти

### Скрипты командной строки

Включить диск:
```bash
sudo ./scripts/power_on.sh <модуль> <позиция>
```

Выключить диск:
```bash
sudo ./scripts/power_off.sh <модуль> <позиция>
```

Смонтировать диск:
```bash
sudo ./scripts/mount_disk.sh <путь_к_устройству> <точка_монтирования>
```

## Конфигурация

Файл `DISK_WWN.csv` содержит сопоставление между идентификаторами WWN дисков и их физическими позициями:

```
wwn;module;position;mount_point
wwn-0x5000039d68d2a2b3;1;1;M1
...
```

- `wwn`: Идентификатор World Wide Name для диска
- `module`: Номер модуля (1-5)
- `position`: Позиция в модуле (1-12)
- `mount_point`: Имя каталога, где диск будет смонтирован в `/mnt/`

## Требования

- Python 3.x
- pandas
- rich
- Диски с файловой системой XFS
- Последовательное соединение с контроллером дисков
- Права суперпользователя для управления оборудованием

## Установка

1. Установите необходимые пакеты Python:
   ```bash
   pip install -r requirements.txt
   ```
   или
   ```bash
   pip install pandas rich
   ```

2. Убедитесь, что последовательный порт доступен:
   ```bash
   sudo usermod -a -G dialout $USER
   ```

3. Сделайте скрипты исполняемыми:
   ```bash
   chmod +x scripts/*.sh
   chmod +x version.sh
   ```

## Версионность

Версия: 1.0.0

Для управления версиями используется скрипт `version.sh`:
```bash
./version.sh show    # Показать текущую версию
./version.sh patch   # Увеличить патч-версию (например, 1.0.0 -> 1.0.1)
./version.sh minor   # Увеличить минорную версию (например, 1.0.1 -> 1.1.0)
./version.sh major   # Увеличить мажорную версию (например, 1.1.0 -> 2.0.0)
```

## Лицензия

Этот проект лицензирован по лицензии MIT.